<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <style>

        * {box-sizing: border-box;}


        body {
            /* background-color: powderblue; */
            margin: 0px;
            padding: 0px;
        }


        .main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .head {

            width: 80%;
            height: 50px;
            background-color: white;
            position: fixed;
            top: 0;
        }

        .dialogue {
            margin-top: 60px;
            width: 80%;
            /* height: 1000px; */
            /* background-color: aqua; */
            margin-bottom: 160px;
        }


        .footer {
            width: 80%;
            background-color: white;
            position: fixed;
            bottom: 0;
            border: 3px solid rgb(53, 52, 52);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .input_menu {
            display: flex;
            flex-direction: row;
            align-items: center;
            /* background-color: blueviolet; */
            gap: 20px;
            /* border: 3px solid rgb(53, 52, 52);
            border-radius: 12px; */
            /* margin-bottom: 20px; */
        }

        .input_wrapper {
            flex-grow: 1;
        }

        .txta {
            background-color: transparent;
            border: none;
            font-size: 16px;
            padding: 12px;
            width: 100%;
            height: 50px;
            resize: none;
            display: block;
            max-height: 80px;

        }
        .txta:focus {
            outline: none;
        }

        .txta::-webkit-scrollbar{
            width: 0px;
        }

        

        .ask_button {
            width: 23px;
            height: 30px;
            margin-right: 10px;
            border: none;
            background: url("{{ url_for('static', filename='icons/pngegg.png') }}") no-repeat center / contain;
            cursor: pointer;
        }

        

        .cleat_input {
            width: 23px;
            height: 30px;
            margin-left: 10px;
            border: none;
            background: url("{{ url_for('static', filename='icons/free-icon-sweep-7690396.png') }}") no-repeat center / contain;
            cursor: pointer;
        }

        


        .dialogue_title {
            display: inline-block; /* Чтобы span воспринимался как блок */
            padding: 5px 12px;
            margin-bottom: 7px;
            background-color: #6658ea; /* Цвет фона */
            color: white; /* Цвет текста */
            border-radius: 12px;
            font-size: 12px;
            font-family: Calibri;

        }

        .dialogue_item_text {
            font-size: 16px;
            margin-bottom: 12px;
            font-family: Calibri;
        }

        .input_top_menu {
            margin: 0px;
        }

        .model_button {
            font-size: 12px;
            background-color: grey;
            color: white;
            padding: 10px 10px;
            border: none;
            cursor: pointer;
            border-radius: 9px;
        }


    </style>
</head>
<body>

<div class="main">

    <div class="head"></div>

    <div class="dialogue" id="dialogue">
        <div class="dialogue_item">
            <div class="dialogue_item_logo"><span class="dialogue_title">AGM</span></div>
            <div class="dialogue_item_text">Ask anything!</div>
        </div>

    <div class="footer">

        <div class="input_top_menu">
            <button class="model_button" id="3.5" onclick="ChooseModel(this.id)">GPT-3.5</button>
            <button class="model_button" id="4.0" onclick="ChooseModel(this.id)">GPT-4.0</button>
        </div>

        <div class="input_menu">

            <div class="input_wrapper">
                <textarea class="txta" id="txta" placeholder="Send message"></textarea>
            </div>
            <div class="ask_button_wrapper">
                <button class="ask_button" id="ask_button" onclick="Ask()"></button>
            </div>

        </div>

        <div class="input_menu_bottom">
            <button class="cleat_input" onclick="clearInput()"></button>
        </div>

        <input type="file" id="imageInput" accept="image/*" onchange="uploadImage(this)"/>

    </div>



</div>


<script>
function uploadImage(inputElement) {
    const file = inputElement.files[0];
    const imageURL = URL.createObjectURL(file);
    const img = document.createElement('img');
    img.src = imageURL;
    img.width = 200; // Ширина в пикселях
    img.height = 150; // Высота в пикселях
    img.alt = 'Описание изображения';
    document.getElementById('dialogue').appendChild(img);
};
</script>

<script>
    var Model = "3.5"
    document.getElementById("3.5").style.backgroundColor = '#6658ea'
    function ChooseModel(clicked_id) {
        Model = clicked_id;
        const buttons = document.querySelectorAll('button.model_button');
        buttons.forEach(button => {
        button.style.backgroundColor = 'grey';
        });
        const button = document.getElementById(clicked_id);
        button.style.backgroundColor = '#6658ea';
    }
</script>

<script>
    const textarea = document.querySelector('textarea');
    textarea.addEventListener("keyup", e => {
        textarea.style.height = "50px";
        let scHeight = e.target.scrollHeight;
        textarea.style.height = `${scHeight}px`;  
    });
</script>

<script>
    function clearInput() {
        document.getElementById('txta').value = '';
        const textarea = document.querySelector('textarea');
        textarea.style.height = "50px";
    }
</script>

<script>
    function CreateItem(text, type) {

        let dialogue = document.getElementById("dialogue")


        let dialogue_item = document.createElement('div');
        dialogue_item.className = "dialogue_item";

        let dialogue_item_logo = document.createElement('div');
        dialogue_item_logo.className = "dialogue_item_logo";

        let dialogue_item_logo_span = document.createElement('span');
        dialogue_item_logo_span.className = "dialogue_title";
        if (type == 'user') {
            dialogue_item_logo_span.textContent = 'USER'
        } else {
            dialogue_item_logo_span.textContent = 'AGM'
        };

        dialogue_item_logo.appendChild(dialogue_item_logo_span);
        dialogue_item.appendChild(dialogue_item_logo);

        let dialogue_item_text = document.createElement('div');
        dialogue_item_text.className = "dialogue_item_text";
        dialogue_item_text.innerText = text;

        dialogue_item.appendChild(dialogue_item_text);

        dialogue.append(dialogue_item);

        dialogue_item.scrollIntoView({ behavior: 'smooth' });

    };

    function Ask() {
        let question = document.getElementById('txta').value.trim();
        if (question.length == 0) {
            clearInput()
            return
        }
        CreateItem(question, 'user');
        clearInput()

        fetch("{{ url_for('question') }}", {
            method: "POST",
            body: JSON.stringify({question: question}),
            headers: {"Content-type": "application/json; charset=UTF-8"}
        }).then(response => response.json()).then(data => CreateItem(data.answer, 'agm'))
        };
</script>



</body>
</html>